%\VignetteIndexEntry{Statistical Working Paper on balancing of the FBS}
%\VignetteEngine{knitr::knitr}

%\documentclass[nojss]{jss}
%\usepackage[]{graphicx}
%\usepackage[]{color}
%\usepackage{geometry}

\documentclass[nojss]{jss}
\usepackage{url}
\usepackage[sc]{mathpazo}
\usepackage{geometry}
\geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\usepackage{breakurl}
\usepackage{hyperref}
\usepackage[ruled, vlined]{algorithm2e}
\usepackage{mathtools}
\usepackage{draftwatermark}
\usepackage{float}
\usepackage{placeins}
\usepackage{mathrsfs}
\usepackage{multirow}
\usepackage{courier}


%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
%\makeatotherx


%\usepackage{framed}
%\makeatletter
%\newenvironment{kframe}{%
% \def\at@end@of@kframe{}%
% \ifinner\ifhmode%
%  \def\at@end@of@kframe{\end{minipage}}%
%  \begin{minipage}{\columnwidth}%
% \fi\fi%
% \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
% \colorbox{shadecolor}{##1}\hskip-\fboxsep
%     % There is no \\@totalrightmargin, so:
%     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
% \MakeFramed {\advance\hsize-\width
%   \@totalleftmargin\z@ \linewidth\hsize
%   \@setminipage}}%
% {\par\unskip\endMakeFramed%
% \at@end@of@kframe}
%\makeatother

%\definecolor{shadecolor}{rgb}{.97, .97, .97}
%\definecolor{messagecolor}{rgb}{0, 0, 0}
%\definecolor{warningcolor}{rgb}{1, 0, 1}
%\definecolor{errorcolor}{rgb}{1, 0, 0}
%\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{url}
\usepackage[sc]{mathpazo}
%\usepackage{geometry}
%\geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\usepackage{breakurl}
\usepackage{hyperref}
%\usepackage[ruled, vlined]{algorithm2e}
%\usepackage{mathtools}
%\usepackage{draftwatermark}
%\usepackage{float}
%\usepackage{placeins}
%\usepackage{mathrsfs}
%\usepackage{multirow}
%% \usepackage{mathbbm}
%\DeclareMathOperator{\sgn}{sgn}
%\DeclareMathOperator*{\argmax}{\arg\!\max}

\title{\bf faoswsTrade: Data Sources}

\author{Marco Garieri \\ Food and Agriculture Organization \\ of
  the United Nations}

\Plainauthor{M. Garieri}

\Plaintitle{faoswsProduction: Data Sources}

\Shorttitle{Data Source}

\Abstract{

\noindent
This vignette provides a detailed description of the various data sources used in the trade modules.
}

\Keywords{Agricultural Trade, Tariff Line, Eurostat, Mirroring}

\Address{
  Marco Garieri\\
  Economics and Social Statistics Division (ESS)\\
  Economic and Social Development Department (ES)\\
  Food and Agriculture Organization of the United Nations (FAO)\\
  Viale delle Terme di Caracalla 00153 Rome, Italy\\
  E-mail: \email{marco.garieri@fao.org}\\
  URL: \url{https://gitlab.com/faoess/tradeproc}
}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}

\begin{document}

\newpage

%\section*{Disclaimer}
%This Working Paper should not be reported as representing the official view of
%the FAO. The views expressed in this Working Paper are those of the
%author and do not necessarily represent those of the FAO or FAO
%policy. Working Papers describe research in progress by the authors and
%are published to elicit comments and to further discussion.\\
%
%This paper is dynamically generated on \today{} and is subject to
%changes and updates.

%\section{Data Source}
%\subsection{Flow Chart}
%Description of the entire flow
%\begin{center}\includegraphics[scale = 0.01]{"trade_1"}\end{center}

%\newpage
%\begin{center}\includegraphics{"trade_4"}\end{center}
%\begin{center}\includegraphics[width=20mm,scale=0.1]{"trade_legend"}\end{center}


\section{Data}
Data are provided by Giorgio's team for both UNSD Tariffline and Eurostat Data. The data have been already prefiltered:
\begin{itemize}
\item [\bf{Eurostat}]
\begin{itemize}
\item code of reporter (declarant) just numeric (letters are not allowed)
\item code of partner (partner) just numeric (letters are not allowed)
\item code of CN8 (product\_nc) just numeric (letters are not allowed)
\end{itemize}
\item [\bf{UNSD}]
\begin{itemize}
\item code of HS (comm) just numeric (letters are not allowed)
\end{itemize}
\end{itemize}

% This is the summary of the data received:
% \begin{itemize}
% \item[\bf{Eurostat}]
% \begin{itemize}
% \item[2009] Number of records: 8665414, distribution of digits: 2 - 446403 (5\%), 8 - 8219011 (95\%)
% \item[2010] Number of records: 8861460, distribution of digits: 2 - 449191 (5\%), 8 - 8412269 (95\%)
% \item[2011] Number of records: 8977093, distribution of digits: 2 - 458032 (5\%), 8 - 8519061 (95\%)
% \item[2012] Number of records: 9299996, distribution of digits: 2 - 468915 (5\%), 8 - 8831081 (95\%)
% \item[2013] Number of records: 9493511, distribution of digits: 2 - 476782 (5\%), 8 - 9016729 (95\%)
% \item[2014] Number of records: 9610127, distribution of digits: 2 - 480525 (5\%), 8 - 9129602 (95\%)
% \end{itemize}
% \item[\bf{UNSD}]
% \begin{itemize}
% \item[2009] Number of records: 40262359, distribution of digits: 2 - 62687 (0.2\%), 4 - 822372 (0.02\%), 5 - 63 (0\%), 6 - 7197277 (18\%), 7 - 331 (0\%), 8 - 20218041 (50\%), 9 - 722018 (2\%), 10 - 6789612 (17\%), 11 - 2769625 (7\%), 12 - 1680333 (4\%)
% \item[2010] Number of records: 46654452, distribution of digits: 2 - 30547 (0.1\%), 4 - 199688 (0.4\%), 5 - 0 (0\%), 6 - 12394503 (27\%), 7 - 54685 (0.1\%), 8 - 21595733 (46\%), 9 - 608860 (1\%), 10 - 9102501 (20\%), 11 - 2667935 (6\%), 12 - 0 (0\%)
% \item[2011] Number of records: 63535135, distribution of digits: 2 - 41486 (0.1\%), 4 - 1640555 (2.6\%), 5 - 1 (0\%), 6 - 14427100 (23\%), 7 - 8447 (0\%), 8 - 28948926 (46\%), 9 - 636035 (1\%), 10 - 13379759 (21\%), 11 - 2645793 (4\%), 12 - 1807033 (3\%)
% \item[2012] Number of records: 66175819, distribution of digits: 2 - 42165 (0.1\%), 4 - 131569 (0.2\%), 5 - 0 (0\%), 6 - 18723116 (28\%),  7- 14986 (0\%), 8 - 32048866 (48\%), 9 - 643335 (1\%), 10 - 13565552 (21\%), 11 - 1006230 (1.5\%), 12 - 0 (0\%)
% \item[2013] Number of records: 70075550, distribution of digits: 2 - 25395 (0\%), 4 - 995 (0\%), 5 - 0 (0\%), 6 - 26224495 (37\%), 7 - 16979 (0\%), 8 - 32652742 (47\%), 9 - 654930 (1\%), 10 - 9765518 (14\%), 11 - 734496 (1\%), 12 - 0 (0\%)
% \item[2014] Number of records: 79728175, distribution of digits: 2 - 59500 (0.1\%), 4 - 222713 (0.3\%), 5 - 0 (0\%), 6 - 25279829 (32\%), 7 - 66423 (0.1\%), 8 - 42679600 (54\%), 9 - 649753 (1\%), 10 - 10088068 (13\%), 11 - 682289 (1\%), 12 - 0 (0\%)
% \end{itemize}
% \end{itemize}

\subsection{Example of tables}
<<echo=FALSE>>=
# Set up a database connection so we can pull the datasets
#library(faosws)
library(data.table)
library(xtable)
#SetClientFiles("~/R certificate files/QA/")
#GetTestEnvironment(
#    baseUrl = "https://hqlqasws1.hq.un.fao.org:8181/sws",
#    token = "c585c410-fb9e-44ea-ba36-ef940d32185d"
#)
@


%\begin{itemize}
%    \item Tariff Line:
%<<echo = FALSE, results='tex',comment=''>>=
%load("~/Dropbox/tradeproc/tldata_raw_from_db.RData")
%print(xtable(head(tldata,4)), include.rownames = FALSE)
%@

%\end{itemize}

\section{Process}
\subsection{Raw Data - Data content assessment}
Pre-analysis of the data is performed in the first part of the module.\\
The total number of records is calculate for both Eurostat and UNSD Tariffline datasets and the distribution of lenght of the commodty HS codes (for UNSD Tariffline) and CN8 for Eurostat is performed. For each country we report if data includes imports, exports, re-exports and re-imports at all possible lenght.\\
All records with hs-lenght (for UNSD Tariffline) or CN8-lenght (for Eurostat) less than 6 are removed.\\
Moreover all records of European reporters in UNSD Tariffline data are removed.

\subsection{UNSD Assessed Tariffline Data and Eurostat Data}
At this stage a standardization/mapping step is performed. The details are devided between UNSD Tariffline and Eurostat due to the nature of the differences among the two datasets.
\subsubsection{UNSD Tariffline Data}
UNSD Tariffline data reports area code with M49 standard. The area code is converted in FAO country code using a specific convertion table provided by Eduard from Tubiello's team. Area codes not mapping to any FAO country code or mapping to code 252 (which correpond not defined area) is reported are the records for these area codes are removed.\\
Commodity codes are reported in HS codes ({\it Harmonized Commodity Description and Coding System}). The codes are converted in FCL (FAO Commodity List) codes. This step is performed using a specific package ({\tt hsfclmap} developed by Alexander Matrunich) where, for each year, all the mapping between HS and FCL code is stored. The algotithm tries to map at all possible lenght (i.e. if a reporting country has a record with hs code at 12 digits and in the package, for the same reporting country, a HS-to-FCL mapping is available at a lower level, for example 10 digits, the algorithm will include in the mapping all the records having the same 10 digits).\\
If a specific record has a HS code not mapping to any specific FCL code, then the record is reported and removed.\\
If a country is not included in the package of the mapping for that specific year, all the records for the reporting country are removed.\\
Information of the FCL units is added at the end of this step.\\
Just for UNSD Tariffline data convertion of units of measurements are applied to meet FAO standards, where all weights are reported in metric tonnes, animals in heads or 1000 heads and for some commodity just the value is provided.\\
The flow codes of re-Import (4) are recoded into Import (1) and codes of re-Export (3) to Export (2). This procedure is applied following UNSD standards:
\begin{quote}
\underline{Distinction between Exports and Re-exports / Imports and Re-imports}\\
Exports of a country can be distinguished as exports of domestic goods and exports of foreign goods. The second class is generally referred to as re-exports. The exports shown in our database contain both the exports of domestic and foreign goods. Re-exports are exports of foreign goods in the same state as previously imported; they are to be included in the country exports. It is recommended that they be recorded separately for analytical purposes. This may require the use of supplementary sources of information in order to determine the origin of re-exports, i.e., to determine that the goods in question are indeed re-exports rather than the export of goods that have acquired domestic origin through processing. Re-imports are goods imported in the same state as previously exported. They are included in the country imports. It is recommended that they be recorded separately for analytical purposes. This may require the use of supplementary sources of information in order to determine the origin of re-imports, i.e., to determine that the goods in question are indeed re-imports rather than the import of goods that have acquired foreign origin through processing. There are several reasons why an exported good might return to the country of origin. The exported good might be defective, the importer might have defaulted on payments or cancelled the order, the authorities might have imposed an import barrier, or demand or prices in the country of origin might have made it worthwhile to bring the good back.
\end{quote}

\subsubsection{Eurostat Data}
Eurostat data reports area code with geonomenclature standard. The are code is converted in FAO country code using a specific convertion table provided by Claudia.  Area codes not mapping to any FAO country code or mapping to code 252 (which correpond not defined area) is reported are the records for these area codes are removed.\\
Commodity codes are reported in CN8 codes (Combined Nomenclature 8 digits). The codes are converted in FCL (FAO Commodity List) codes. This step is performed using the same package ({\tt hsfclmap}) as for UNSD Tariffline.
If a specific record has a CN8 code not mapping to any specific FCL code, then the record is reported and removed.\\
If a country is not included in the package of the mapping for that specific year, all the records for the reporting country are removed.\\\\
The possible solution for the missing links in the future using Natural language processing routines to read the metadata.\\
Information of the FCL units is added at the end of this step.\\
Values are converted from EUR to USD using the table with avarage currency for each year provided by Claudia.\\
Eurostat data are already provided in the correct units of measurements and do not need futher conversions.
%e.	Application of perennial notes, which at this stage mainly regard quantity adjustments

\subsubsection{Unified Official Trade Flows Dataset}
At this step the UNSD Tariffline and Eurostat datasets are ready to be merged.\\
Application of perennial and yearly specific notes are applied. These mainly regard quantity adjutments.\\
An analysis of self trade is performed: for all the records with the same reporter and partner country the sum of the value and the list of commodities is saved and summary statistics are computer world wide.\\
For each record the unit of value is computed as the value divided by the quantity and the validation steps are applied:
\begin{itemize}
\item[Outlier Detection] The outlier are calculated based on the distribution of the unit of value for the same country, year and flow at the HS level. The reason to identify the outlier at the HS level is due to the fact that, under the same FCL code, different commodity might fall (i.e. maize seed and seed). The records with wrong order of magnitude are detected. The outlier are corrected using the corresponding value and dividing it by the median unit of value of that specific commodity, country, flow and year. In this way only few official data are corrected.
\item[Missing Quantities] For records in which the commodity has to be reported in quantity and the quantity is missing and the value is present, the corresponding quantity is imputed dividing the corresponding value by the median of the units of value of the corresponding commodity (HS level/country/flow/year)
\end{itemize}

The module produce the list of non-reporting countries: these are the countries present as partners but absent as reporters. For this countries the mirroring process is applied: the corrisponding trade of the non-reporting countries are extracted from the partners inverting the flows.\\

The flows at this point are aggregated by reported over partner countries to a single total trade for each unique FCL commodity code.\\
Upon availability of time-series data, a check of the FCL-based unit values accross the time series is performed.\\
A check is performed to account of the CIF/FOB differences [around 12\%?] (still to be perfomed among time series).

\subsubsection{Unbalanced World Trade Matrix}
The commodity balance check is computed, which will lead to the "Trade Imbalances" report (not yet implemented).

\subsubsection{Finalized Total Trade}
The convertion from FCL to CPC version 2.1 expanded is added and the final output tables of trade by commodity is provided.


\end{document}
Status API Training Shop Blog About
ÔøΩ 2015 GitHub, Inc. Terms Privacy Security Contact
%
